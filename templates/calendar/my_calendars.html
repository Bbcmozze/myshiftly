{% extends "base.html" %}
{% from "friends/macroc.html" import pluralize %}

{% block title %}Мои календари - My Shiftly{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/calendar/list.css') }}">
{% endblock %}

{% block content %}
<!-- Модальное окно для подтверждения удаления -->
<div id="deleteModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Подтверждение удаления</h3>
            <button class="modal-close" onclick="closeDeleteModal()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="delete-warning">
                <i class="bi bi-exclamation-triangle"></i>
                <p>Вы уверены, что хотите удалить календарь <strong id="calendarNameToDelete"></strong>?</p>
                <p class="warning-text">Это действие нельзя отменить. Все данные календаря будут безвозвратно удалены.</p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeDeleteModal()">Отмена</button>
            <button class="btn btn-danger" onclick="confirmDelete()">Удалить календарь</button>
        </div>
    </div>
</div>

<div class="calendars-container">
    <div class="calendars-header">
        <h2>Мои календари</h2>
        <a href="{{ url_for('create_calendar') }}" class="btn btn-primary">
            <i class="bi bi-plus-lg"></i> Создать новый
        </a>
    </div>

    <div class="calendar-tabs">
        <div class="tab-header">
            <button class="tab-btn active" data-tab="personal">Личные</button>
            <button class="tab-btn" data-tab="team">Командные</button>
            <button class="tab-btn" data-tab="shared">Общие</button>
        </div>

        <div class="tab-content active" id="personal-tab">
            {% if personal_calendars %}
            <div class="calendar-grid">
                {% for calendar in personal_calendars %}
                <div class="calendar-card">
                    <div class="calendar-header">
                        <button class="delete-btn" data-calendar-id="{{ calendar.id }}" data-calendar-name="{{ calendar.name }}" title="Удалить календарь">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </div>
                    <div class="calendar-info">
                        <h3>{{ calendar.name }}</h3>
                        <p>Личный календарь</p>
                        <div class="calendar-meta">
                            <span><i class="bi bi-calendar3"></i> {{ calendar.created_at.strftime('%d.%m.%Y') }}</span>
                        </div>
                    </div>
                    <div class="calendar-actions">
                        <a href="{{ url_for('view_calendar', calendar_id=calendar.id) }}" class="btn btn-sm btn-primary">
                            Открыть
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="no-calendars">
                <i class="bi bi-calendar-x"></i>
                <h3>Нет личных календарей</h3>
                <p>Создайте личный календарь для управления своими сменами</p>
            </div>
            {% endif %}
        </div>

        <div class="tab-content" id="team-tab">
            {% if team_calendars %}
            <div class="calendar-grid">
                {% for calendar in team_calendars %}
                <div class="calendar-card">
                    <div class="calendar-header">
                        <button class="delete-btn" data-calendar-id="{{ calendar.id }}" data-calendar-name="{{ calendar.name }}" title="Удалить календарь">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </div>
                    <div class="calendar-info">
                        <h3>{{ calendar.name }}</h3>
                        <p>Командный календарь · {{ pluralize(calendar.members|length, 'участник', 'участника', 'участников') }}</p>
                        <div class="calendar-meta">
                            <span><i class="bi bi-calendar3"></i> {{ calendar.created_at.strftime('%d.%m.%Y') }}</span>
                        </div>
                    </div>
                    <div class="calendar-actions">
                        <a href="{{ url_for('view_calendar', calendar_id=calendar.id) }}" class="btn btn-sm btn-primary">
                            Открыть
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="no-calendars">
                <i class="bi bi-calendar-x"></i>
                <h3>Нет командных календарей</h3>
                <p>Создайте командный календарь для управления сменами ваших коллег</p>
            </div>
            {% endif %}
        </div>

        <div class="tab-content" id="shared-tab">
            {% if shared_calendars %}
            <div class="calendar-grid">
                {% for calendar in shared_calendars %}
                <div class="calendar-card">
                    {% if calendar.owner_id == current_user.id %}
                    <div class="calendar-header">
                        <button class="delete-btn" data-calendar-id="{{ calendar.id }}" data-calendar-name="{{ calendar.name }}" title="Удалить календарь">
                            <i class="bi bi-trash3"></i>
                        </button>
                    </div>
                    {% endif %}
                    <div class="calendar-info">
                        <h3>{{ calendar.name }}</h3>
                        <p>Общий календарь · Создатель: {{ calendar.owner.username }}</p>
                        <div class="calendar-meta">
                            <span><i class="bi bi-calendar3"></i> {{ calendar.created_at.strftime('%d.%m.%Y') }}</span>
                        </div>
                    </div>
                    <div class="calendar-actions">
                        <a href="{{ url_for('view_calendar', calendar_id=calendar.id) }}" class="btn btn-sm btn-primary">
                            Открыть
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="no-calendars">
                <i class="bi bi-calendar-x"></i>
                <h3>Нет общих календарей</h3>
                <p>Здесь будут отображаться календари, которыми с вами поделились</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/friends/search.js') }}"></script>
<script src="{{ url_for('static', filename='js/calendar/my_calendars.js') }}"></script>
{% endblock %}